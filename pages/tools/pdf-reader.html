<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PDF Reader - Poornimites Toolkit</title>
    <link rel="stylesheet" href="../../chat/style.css">
    <link rel="stylesheet" href="../../assets/css/header.css">
    <link rel="stylesheet" href="../../assets/css/footer.css">
    <link rel="stylesheet" href="../../assets/css/modules/tools/toolkit.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
</head>

<body>
    <header class="navbar">
        <div class="logo">üéì <a href="../../index.html">Poornimites</a></div>
        <nav class="nav-links">
            <a href="../../tools.html">‚Üê Back to Toolkit</a>
        </nav>
        <div class="nav-icons">
            <a href="../../index.html">üè†</a>
        </div>
    </header>

    <main class="toolkit-container">
        <div class="toolkit-header">
            <h1>üìÑ PDF Reader</h1>
            <p>View and navigate PDF documents</p>
        </div>

        <div class="tool-section">
            <div class="file-upload mb-3" onclick="document.getElementById('pdfFile').click()">
                <div class="file-upload-icon">üìÅ</div>
                <div>Click to upload PDF file</div>
                <input type="file" id="pdfFile" accept=".pdf" onchange="pdfReader.loadPDF(event)">
            </div>

            <div id="pdfControls" style="display: none;">
                <div class="d-flex justify-between align-center mb-3">
                    <div class="d-flex gap-2 align-center">
                        <button class="btn btn-secondary btn-sm" onclick="pdfReader.prevPage()">‚Üê Previous</button>
                        <span>Page <span id="pageNum">1</span> of <span id="pageCount">0</span></span>
                        <button class="btn btn-secondary btn-sm" onclick="pdfReader.nextPage()">Next ‚Üí</button>
                    </div>

                    <div class="d-flex gap-2 align-center">
                        <button class="btn btn-secondary btn-sm" onclick="pdfReader.zoomOut()">-</button>
                        <span id="zoomLevel">100%</span>
                        <button class="btn btn-secondary btn-sm" onclick="pdfReader.zoomIn()">+</button>
                    </div>
                </div>

                <div
                    style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 12px var(--toolkit-shadow); text-align: center; overflow: auto;">
                    <canvas id="pdfCanvas"></canvas>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-links">
            <a href="../site/about.html">About</a>
            <a href="../site/faq.html">FAQ</a>
            <a href="../site/privacy.html">Privacy</a>
        </div>
        <div class="footer-text">
            Made with üíô by Students for Students. ¬© 2025 Poornimites
        </div>
    </footer>

    <script src="../../assets/js/modules/tools/toolkit-common.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        const pdfReader = {
            pdfDoc: null,
            pageNum: 1,
            scale: 1.5,

            async loadPDF(event) {
                const file = event.target.files[0];
                if (!file) return;

                const fileReader = new FileReader();
                fileReader.onload = async (e) => {
                    const typedarray = new Uint8Array(e.target.result);

                    try {
                        this.pdfDoc = await pdfjsLib.getDocument(typedarray).promise;
                        document.getElementById('pageCount').textContent = this.pdfDoc.numPages;
                        document.getElementById('pdfControls').style.display = 'block';
                        this.renderPage(1);
                        ToolkitUtils.showToast('PDF loaded successfully!', 'success');
                    } catch (error) {
                        ToolkitUtils.showToast('Error loading PDF: ' + error.message, 'error');
                    }
                };
                fileReader.readAsArrayBuffer(file);
            },

            async renderPage(num) {
                this.pageNum = num;
                document.getElementById('pageNum').textContent = num;

                const page = await this.pdfDoc.getPage(num);
                const viewport = page.getViewport({ scale: this.scale });

                const canvas = document.getElementById('pdfCanvas');
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };

                await page.render(renderContext).promise;
            },

            prevPage() {
                if (this.pageNum <= 1) return;
                this.renderPage(this.pageNum - 1);
            },

            nextPage() {
                if (this.pageNum >= this.pdfDoc.numPages) return;
                this.renderPage(this.pageNum + 1);
            },

            zoomIn() {
                this.scale += 0.25;
                document.getElementById('zoomLevel').textContent = Math.round(this.scale * 100) + '%';
                this.renderPage(this.pageNum);
            },

            zoomOut() {
                if (this.scale <= 0.5) return;
                this.scale -= 0.25;
                document.getElementById('zoomLevel').textContent = Math.round(this.scale * 100) + '%';
                this.renderPage(this.pageNum);
            }
        };
    </script>
</body>

</html>