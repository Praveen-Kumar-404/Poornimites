<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reminders - Poornimites Toolkit</title>
    <link rel="stylesheet" href="../../assets/css/core/style.css">
    <link rel="stylesheet" href="../../assets/css/core/header.css">
    <link rel="stylesheet" href="../../assets/css/core/footer.css">
    <link rel="stylesheet" href="../../assets/css/modules/tools/toolkit.css">
</head>

<body>
    <header class="navbar">
        <div class="logo">üéì <a href="../../index.html">Poornimites</a></div>
        <nav class="nav-links">
            <a href="tools.html">‚Üê Back to Toolkit</a>
        </nav>
        <div class="nav-icons">
            <a href="../../index.html">üè†</a>
        </div>
    </header>

    <main class="toolkit-container">
        <div class="toolkit-header">
            <h1>üîî Reminders</h1>
            <p>Set reminders with browser notifications</p>
        </div>

        <div class="tool-grid">
            <div>
                <div class="tool-section">
                    <h2>Create Reminder</h2>

                    <div class="form-group">
                        <label class="form-label">Reminder Title</label>
                        <input type="text" id="reminderTitle" class="form-control"
                            placeholder="e.g., Submit assignment">
                    </div>

                    <div class="tool-grid">
                        <div class="form-group">
                            <label class="form-label">Date</label>
                            <input type="date" id="reminderDate" class="form-control">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Time</label>
                            <input type="time" id="reminderTime" class="form-control">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Notes</label>
                        <textarea id="reminderNotes" class="form-control" rows="3"
                            placeholder="Additional details..."></textarea>
                    </div>

                    <button class="btn btn-primary btn-block" onclick="reminders.add()">+ Add Reminder</button>
                </div>
            </div>

            <div>
                <div class="tool-section">
                    <h2>Upcoming Reminders</h2>
                    <div id="remindersList"></div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-links">
            <a href="../site/about.html">About</a>
            <a href="../site/faq.html">FAQ</a>
            <a href="../site/privacy.html">Privacy</a>
        </div>
        <div class="footer-text">
            Made with üíô by Students for Students. ¬© 2025 Poornimites
        </div>
    </footer>

    <script src="../../assets/js/modules/tools/toolkit-common.js"></script>
    <script>
        const reminders = {
            all: [],
            checkInterval: null,

            init() {
                this.load();
                this.render();
                this.requestPermission();
                this.startChecking();

                // Set default to tomorrow
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                document.getElementById('reminderDate').value = tomorrow.toISOString().split('T')[0];
                document.getElementById('reminderTime').value = '09:00';
            },

            requestPermission() {
                if ('Notification' in window && Notification.permission === 'default') {
                    Notification.requestPermission();
                }
            },

            add() {
                const title = document.getElementById('reminderTitle').value.trim();
                const date = document.getElementById('reminderDate').value;
                const time = document.getElementById('reminderTime').value;

                if (!title || !date || !time) {
                    ToolkitUtils.showToast('Please fill in all fields', 'warning');
                    return;
                }

                const dateTime = new Date(`${date}T${time}`);

                if (dateTime <= new Date()) {
                    ToolkitUtils.showToast('Please select a future date/time', 'warning');
                    return;
                }

                const reminder = {
                    id: ToolkitUtils.generateId('reminder'),
                    title,
                    dateTime: dateTime.toISOString(),
                    notes: document.getElementById('reminderNotes').value.trim(),
                    triggered: false,
                    createdAt: new Date()
                };

                this.all.push(reminder);
                this.save();
                this.render();

                // Clear form
                document.getElementById('reminderTitle').value = '';
                document.getElementById('reminderNotes').value = '';

                ToolkitUtils.showToast('Reminder created!', 'success');
            },

            delete(id) {
                if (confirm('Delete this reminder?')) {
                    this.all = this.all.filter(r => r.id !== id);
                    this.save();
                    this.render();
                    ToolkitUtils.showToast('Reminder deleted', 'info');
                }
            },

            startChecking() {
                // Check every minute
                this.checkInterval = setInterval(() => {
                    this.checkReminders();
                }, 60000);

                // Also check immediately
                this.checkReminders();
            },

            checkReminders() {
                const now = new Date();

                this.all.forEach(reminder => {
                    if (!reminder.triggered) {
                        const reminderTime = new Date(reminder.dateTime);

                        if (reminderTime <= now) {
                            this.trigger(reminder);
                        }
                    }
                });
            },

            trigger(reminder) {
                reminder.triggered = true;
                this.save();
                this.render();

                // Show browser notification
                if ('Notification' in window && Notification.permission === 'granted') {
                    new Notification('üîî Reminder', {
                        body: reminder.title,
                        icon: 'üîî',
                        requireInteraction: true
                    });
                }

                // Also show toast
                ToolkitUtils.showToast(`Reminder: ${reminder.title}`, 'info');
            },

            render() {
                const container = document.getElementById('remindersList');

                // Sort by date
                const sorted = [...this.all].sort((a, b) =>
                    new Date(a.dateTime) - new Date(b.dateTime)
                );

                // Filter out old triggered reminders
                const active = sorted.filter(r => {
                    const reminderTime = new Date(r.dateTime);
                    const dayOld = new Date(Date.now() - 24 * 60 * 60 * 1000);
                    return !r.triggered || reminderTime > dayOld;
                });

                if (active.length === 0) {
                    container.innerHTML = '<p class="text-muted text-center">No upcoming reminders</p>';
                    return;
                }

                container.innerHTML = active.map(reminder => {
                    const dateTime = new Date(reminder.dateTime);
                    const now = new Date();
                    const isPast = dateTime < now;

                    return `
                    <div class="card mb-2 p-3 ${reminder.triggered ? 'opacity-50' : ''}">
                        <div class="d-flex justify-between align-center">
                            <div style="flex: 1;">
                                <div style="font-weight: 600; font-size: 1.1rem;">
                                    ${reminder.triggered ? '‚úì ' : ''}${reminder.title}
                                </div>
                                <div class="text-muted mt-1">
                                    üìÖ ${dateTime.toLocaleDateString()} at ${dateTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                                </div>
                                ${reminder.notes ? `<div class="mt-2" style="color: #666;">${reminder.notes}</div>` : ''}
                                ${isPast && !reminder.triggered ? '<div class="text-danger mt-1">‚ö†Ô∏è Overdue</div>' : ''}
                            </div>
                            <button class="btn btn-danger btn-sm" onclick="reminders.delete('${reminder.id}')">√ó</button>
                        </div>
                    </div>
                `;
                }).join('');
            },

            save() {
                ToolkitUtils.storage.save('reminders_data', this.all);
            },

            load() {
                this.all = ToolkitUtils.storage.load('reminders_data', []);
            }
        };

        reminders.init();

        // Clean up on page unload
        window.addEventListener('beforeunload', () => {
            if (reminders.checkInterval) {
                clearInterval(reminders.checkInterval);
            }
        });
    </script>
</body>

</html>

