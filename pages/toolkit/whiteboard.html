<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Whiteboard - Poornimites Toolkit</title>
  <link rel="stylesheet" href="../../assets/css/style.css">
  <link rel="stylesheet" href="../../assets/css/header.css">
  <link rel="stylesheet" href="../../assets/css/footer.css">
  <link rel="stylesheet" href="../../assets/css/toolkit.css">
  <style>
    .whiteboard-container {
      background: white;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 4px 12px var(--toolkit-shadow);
    }

    .toolbar {
      display: flex;
      gap: 0.5rem;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 8px;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      align-items: center;
    }

    .tool-group {
      display: flex;
      gap: 0.5rem;
      padding: 0 0.5rem;
      border-right: 2px solid #dee2e6;
    }

    .tool-group:last-child {
      border-right: none;
    }

    .tool-btn {
      padding: 0.5rem 1rem;
      border: 2px solid transparent;
      background: white;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 1.2rem;
    }

    .tool-btn:hover {
      background: #e9ecef;
    }

    .tool-btn.active {
      background: var(--toolkit-primary);
      color: white;
      border-color: var(--toolkit-primary);
    }

    .color-picker-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 3px solid #dee2e6;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .color-picker-btn:hover {
      transform: scale(1.1);
    }

    .color-picker-btn.active {
      border-color: var(--toolkit-dark);
      border-width: 4px;
    }

    #whiteboardCanvas {
      border: 2px solid #dee2e6;
      border-radius: 8px;
      cursor: crosshair;
      background: white;
      display: block;
      touch-action: none;
    }

    .size-slider {
      width: 100px;
    }

    .canvas-wrapper {
      overflow: auto;
      max-height: calc(100vh - 400px);
    }

    @media (max-width: 768px) {
      .toolbar {
        justify-content: center;
      }

      .tool-group {
        border-right: none;
        padding: 0.25rem;
      }
    }
  </style>
</head>

<body>
  <header class="navbar">
    <div class="logo">🎓 <a href="../../index.html">Poornimites</a></div>
    <nav class="nav-links">
      <a href="../../tools.html">← Back to Toolkit</a>
    </nav>
    <div class="nav-icons">
      <a href="../../index.html">🏠</a>
    </div>
  </header>

  <main class="toolkit-container">
    <div class="toolkit-header">
      <h1>🎨 Collaborative Whiteboard</h1>
      <p>Draw, sketch, and collaborate in real-time</p>
    </div>

    <div class="whiteboard-container">
      <!-- Toolbar -->
      <div class="toolbar">
        <!-- Drawing Tools -->
        <div class="tool-group">
          <button class="tool-btn active" data-tool="pen" title="Pen">✏️</button>
          <button class="tool-btn" data-tool="eraser" title="Eraser">🧹</button>
          <button class="tool-btn" data-tool="line" title="Line">📏</button>
          <button class="tool-btn" data-tool="rectangle" title="Rectangle">▭</button>
          <button class="tool-btn" data-tool="circle" title="Circle">⭕</button>
          <button class="tool-btn" data-tool="text" title="Text">T</button>
        </div>

        <!-- Colors -->
        <div class="tool-group">
          <button class="color-picker-btn active" style="background: #000000;" data-color="#000000"></button>
          <button class="color-picker-btn" style="background: #FF0000;" data-color="#FF0000"></button>
          <button class="color-picker-btn" style="background: #00FF00;" data-color="#00FF00"></button>
          <button class="color-picker-btn" style="background: #0000FF;" data-color="#0000FF"></button>
          <button class="color-picker-btn" style="background: #FFFF00;" data-color="#FFFF00"></button>
          <button class="color-picker-btn" style="background: #FF00FF;" data-color="#FF00FF"></button>
          <button class="color-picker-btn" style="background: #00FFFF;" data-color="#00FFFF"></button>
          <input type="color" id="customColor" title="Custom Color"
            style="width: 40px; height: 40px; border-radius: 50%; border: none; cursor: pointer;">
        </div>

        <!-- Size -->
        <div class="tool-group">
          <label style="display: flex; align-items: center; gap: 0.5rem;">
            <span>Size:</span>
            <input type="range" id="brushSize" class="size-slider" min="1" max="50" value="3">
            <span id="sizeValue">3</span>
          </label>
        </div>

        <!-- Actions -->
        <div class="tool-group">
          <button class="btn btn-secondary btn-sm" onclick="whiteboard.undo()">↶ Undo</button>
          <button class="btn btn-secondary btn-sm" onclick="whiteboard.redo()">↷ Redo</button>
          <button class="btn btn-secondary btn-sm" onclick="whiteboard.clear()">🗑️ Clear</button>
        </div>

        <!-- Save/Load -->
        <div class="tool-group">
          <button class="btn btn-primary btn-sm" onclick="whiteboard.save()">💾 Save</button>
          <button class="btn btn-secondary btn-sm" onclick="whiteboard.download()">📥 Download</button>
          <button class="btn btn-secondary btn-sm" onclick="document.getElementById('loadImage').click()">📂
            Load</button>
          <input type="file" id="loadImage" accept="image/*" style="display: none;"
            onchange="whiteboard.loadImage(event)">
        </div>
      </div>

      <!-- Canvas -->
      <div class="canvas-wrapper">
        <canvas id="whiteboardCanvas" width="1200" height="700"></canvas>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="footer-links">
      <a href="../../about.html">About</a>
      <a href="../../faq.html">FAQ</a>
      <a href="../../privacy.html">Privacy</a>
    </div>
    <div class="footer-text">
      Made with 💙 by Students for Students. © 2025 Poornimites
    </div>
  </footer>

  <script src="../../assets/js/toolkit-common.js"></script>
  <script>
    const whiteboard = {
      canvas: null,
      ctx: null,
      isDrawing: false,
      currentTool: 'pen',
      currentColor: '#000000',
      brushSize: 3,
      startX: 0,
      startY: 0,
      history: [],
      historyStep: -1,

      init() {
        this.canvas = document.getElementById('whiteboardCanvas');
        this.ctx = this.canvas.getContext('2d');

        // Set up event listeners
        this.canvas.addEventListener('mousedown', (e) => this.startDrawing(e));
        this.canvas.addEventListener('mousemove', (e) => this.draw(e));
        this.canvas.addEventListener('mouseup', () => this.stopDrawing());
        this.canvas.addEventListener('mouseout', () => this.stopDrawing());

        // Touch support
        this.canvas.addEventListener('touchstart', (e) => {
          e.preventDefault();
          const touch = e.touches[0];
          const mouseEvent = new MouseEvent('mousedown', {
            clientX: touch.clientX,
            clientY: touch.clientY
          });
          this.canvas.dispatchEvent(mouseEvent);
        });

        this.canvas.addEventListener('touchmove', (e) => {
          e.preventDefault();
          const touch = e.touches[0];
          const mouseEvent = new MouseEvent('mousemove', {
            clientX: touch.clientX,
            clientY: touch.clientY
          });
          this.canvas.dispatchEvent(mouseEvent);
        });

        this.canvas.addEventListener('touchend', (e) => {
          e.preventDefault();
          const mouseEvent = new MouseEvent('mouseup', {});
          this.canvas.dispatchEvent(mouseEvent);
        });

        // Tool buttons
        document.querySelectorAll('.tool-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            this.currentTool = btn.dataset.tool;
          });
        });

        // Color buttons
        document.querySelectorAll('.color-picker-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            document.querySelectorAll('.color-picker-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            this.currentColor = btn.dataset.color;
          });
        });

        // Custom color
        document.getElementById('customColor').addEventListener('change', (e) => {
          this.currentColor = e.target.value;
          document.querySelectorAll('.color-picker-btn').forEach(b => b.classList.remove('active'));
        });

        // Brush size
        document.getElementById('brushSize').addEventListener('input', (e) => {
          this.brushSize = e.target.value;
          document.getElementById('sizeValue').textContent = e.target.value;
        });

        // Load saved canvas
        this.loadFromStorage();

        // Save initial state
        this.saveState();
      },

      getMousePos(e) {
        const rect = this.canvas.getBoundingClientRect();
        return {
          x: e.clientX - rect.left,
          y: e.clientY - rect.top
        };
      },

      startDrawing(e) {
        this.isDrawing = true;
        const pos = this.getMousePos(e);
        this.startX = pos.x;
        this.startY = pos.y;

        if (this.currentTool === 'pen' || this.currentTool === 'eraser') {
          this.ctx.beginPath();
          this.ctx.moveTo(pos.x, pos.y);
        } else if (this.currentTool === 'text') {
          const text = prompt('Enter text:');
          if (text) {
            this.ctx.font = `${this.brushSize * 8}px Arial`;
            this.ctx.fillStyle = this.currentColor;
            this.ctx.fillText(text, pos.x, pos.y);
            this.saveState();
          }
          this.isDrawing = false;
        }
      },

      draw(e) {
        if (!this.isDrawing) return;

        const pos = this.getMousePos(e);

        if (this.currentTool === 'pen') {
          this.ctx.strokeStyle = this.currentColor;
          this.ctx.lineWidth = this.brushSize;
          this.ctx.lineCap = 'round';
          this.ctx.lineTo(pos.x, pos.y);
          this.ctx.stroke();
        } else if (this.currentTool === 'eraser') {
          this.ctx.clearRect(pos.x - this.brushSize / 2, pos.y - this.brushSize / 2, this.brushSize, this.brushSize);
        }
      },

      stopDrawing() {
        if (!this.isDrawing) return;
        this.isDrawing = false;

        const pos = this.getMousePos(event);

        if (this.currentTool === 'line') {
          this.ctx.strokeStyle = this.currentColor;
          this.ctx.lineWidth = this.brushSize;
          this.ctx.beginPath();
          this.ctx.moveTo(this.startX, this.startY);
          this.ctx.lineTo(pos.x, pos.y);
          this.ctx.stroke();
        } else if (this.currentTool === 'rectangle') {
          this.ctx.strokeStyle = this.currentColor;
          this.ctx.lineWidth = this.brushSize;
          this.ctx.strokeRect(this.startX, this.startY, pos.x - this.startX, pos.y - this.startY);
        } else if (this.currentTool === 'circle') {
          const radius = Math.sqrt(Math.pow(pos.x - this.startX, 2) + Math.pow(pos.y - this.startY, 2));
          this.ctx.strokeStyle = this.currentColor;
          this.ctx.lineWidth = this.brushSize;
          this.ctx.beginPath();
          this.ctx.arc(this.startX, this.startY, radius, 0, 2 * Math.PI);
          this.ctx.stroke();
        }

        this.saveState();
      },

      saveState() {
        this.historyStep++;
        if (this.historyStep < this.history.length) {
          this.history.length = this.historyStep;
        }
        this.history.push(this.canvas.toDataURL());
      },

      undo() {
        if (this.historyStep > 0) {
          this.historyStep--;
          this.restoreState(this.history[this.historyStep]);
        }
      },

      redo() {
        if (this.historyStep < this.history.length - 1) {
          this.historyStep++;
          this.restoreState(this.history[this.historyStep]);
        }
      },

      restoreState(dataUrl) {
        const img = new Image();
        img.onload = () => {
          this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
          this.ctx.drawImage(img, 0, 0);
        };
        img.src = dataUrl;
      },

      clear() {
        if (confirm('Clear the entire whiteboard?')) {
          this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
          this.saveState();
          ToolkitUtils.showToast('Whiteboard cleared', 'info');
        }
      },

      save() {
        const dataUrl = this.canvas.toDataURL();
        ToolkitUtils.storage.save('whiteboard_data', dataUrl);
        ToolkitUtils.showToast('Whiteboard saved!', 'success');
      },

      loadFromStorage() {
        const dataUrl = ToolkitUtils.storage.load('whiteboard_data', null);
        if (dataUrl) {
          this.restoreState(dataUrl);
        }
      },

      download() {
        const dataUrl = this.canvas.toDataURL('image/png');
        const link = document.createElement('a');
        link.download = 'whiteboard_' + new Date().getTime() + '.png';
        link.href = dataUrl;
        link.click();
        ToolkitUtils.showToast('Whiteboard downloaded!', 'success');
      },

      loadImage(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.onload = () => {
            this.ctx.drawImage(img, 0, 0);
            this.saveState();
            ToolkitUtils.showToast('Image loaded!', 'success');
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    };

    whiteboard.init();
  </script>
</body>

</html>